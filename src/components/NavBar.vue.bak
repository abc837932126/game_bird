<template>
  <div class="grid grid-cols-5 border-t bg-white">
    <div
      v-for="nav in navList"
      :key="nav.name"
      @click="game.page = nav.name"
      :class="['py-3 text-center cursor-pointer', game.page === nav.name ? 'text-purple-500' : 'text-gray-500']"
    >
      <!-- å¦‚æœæ˜¯å¥½å‹å¯¼èˆªä¸”æœ‰å¾…å¤„ç†ç”³è¯·ï¼Œæ˜¾ç¤ºçº¢ç‚¹ -->
      <el-badge v-if="nav.name === 'page_friend'" :value="pendingCount" :hidden="pendingCount === 0" type="danger" :offset="[5, 0]">
        <div class="text-xl">{{ nav.icon }}</div>
      </el-badge>
      <div v-else class="text-xl">{{ nav.icon }}</div>
      <div class="text-xs mt-1">{{ nav.label }}</div>
    </div>
    <!-- å…¨å±æŒ‰é’® -->
    <div
      @click="toggleFullscreen"
      class="py-3 text-center cursor-pointer text-gray-500"
    >
      <div class="text-xl">{{ fullscreenIcon }}</div>
      <div class="text-xs mt-1">å…¨å±</div>
    </div>
  </div>
</template>

<script setup>
import { inject, ref, computed, onMounted, onUnmounted } from 'vue'
import { ElBadge } from 'element-plus'
import screenfull from 'screenfull'

const game = inject('game')
const isFullscreen = ref(false)

// è·å–å¾…å¤„ç†å¥½å‹ç”³è¯·æ•°é‡
const pendingCount = computed(() => {
  return game.player_friend?.pendingCount || 0
})

const navList = [
  { name: 'page_home', label: 'é¦–é¡µ', icon: 'ğŸ ' },
  { name: 'page_player_item', label: 'èƒŒåŒ…', icon: 'ğŸ’' },
  { name: 'page_shop', label: 'å•†åº—', icon: 'ğŸ›’' },
  { name: 'page_ladder', label: 'å¤©æ¢¯', icon: 'ğŸ†' },
  { name: 'page_chat', label: 'èŠå¤©', icon: 'ğŸ’¬' },
  { name: 'page_friend', label: 'å¥½å‹', icon: 'ğŸ‘¥' },
  { name: 'page_player_info', label: 'æˆ‘çš„', icon: 'ğŸ‘¤' },
  { name: 'page_player_bird', label: 'ä»“åº“', icon: 'ğŸ¦' },
  { name: 'page_jiaotang', label: 'æ•™å ‚', icon: 'â›ª' }
]

// å…¨å±åˆ‡æ¢åŠŸèƒ½
const toggleFullscreen = () => {
  if (screenfull.isEnabled) {
    screenfull.toggle()
  }
}

// ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
const handleFullscreenChange = () => {
  if (screenfull.isEnabled) {
    isFullscreen.value = screenfull.isFullscreen
  }
}

onMounted(() => {
  if (screenfull.isEnabled) {
    screenfull.on('change', handleFullscreenChange)
  }
  // åŠ è½½å¾…å¤„ç†å¥½å‹ç”³è¯·æ•°é‡
  if (game.player_friend) {
    game.player_friend.updatePending()
  }
})

onUnmounted(() => {
  if (screenfull.isEnabled) {
    screenfull.off('change', handleFullscreenChange)
  }
})

// å…¨å±æŒ‰é’®æ˜¾ç¤ºçš„å›¾æ ‡
const fullscreenIcon = computed(() => isFullscreen.value ? 'ğŸ——' : 'â›¶')
</script>